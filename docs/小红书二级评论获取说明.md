# å°çº¢ä¹¦äºŒçº§è¯„è®ºè·å–è¯´æ˜

## ğŸ“Œ å°çº¢ä¹¦è¯„è®ºå±•å¼€è§„åˆ™

é€šè¿‡è§‚å¯Ÿå°çº¢ä¹¦çš„å®é™…é¡µé¢è¡Œä¸ºï¼Œå‘ç°å…¶äºŒçº§è¯„è®ºå±•å¼€çš„è§„åˆ™å¦‚ä¸‹ï¼š

### ç¬¬ä¸€æ¬¡ç‚¹å‡»"å±•å¼€å›å¤"æ—¶ï¼š

- **å¦‚æœäºŒçº§è¯„è®ºæ€»æ•° > 6æ¡**ï¼šä¼šæ˜¾ç¤º **6æ¡**ï¼ˆåŸæœ¬æ˜¾ç¤ºçš„1æ¡ + æ–°å±•å¼€çš„5æ¡ï¼‰
- **å¦‚æœäºŒçº§è¯„è®ºæ€»æ•° â‰¤ 6æ¡**ï¼šä¼šæ˜¾ç¤º **å…¨éƒ¨**

### ç¤ºä¾‹

```
ä¸€çº§è¯„è®ºA
  â””â”€ äºŒçº§è¯„è®º1ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰
  â””â”€ äºŒçº§è¯„è®º2ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º3ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º4ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º5ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º6ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º7ï¼ˆéšè—ï¼‰
  â””â”€ äºŒçº§è¯„è®º8ï¼ˆéšè—ï¼‰
  [å±•å¼€å›å¤] â† ç‚¹å‡»åæ˜¾ç¤ºè¯„è®º2-6ï¼Œè¯„è®º7-8ä»éšè—
```

## âš™ï¸ é…ç½®æ–¹æ³•

åœ¨ `config/base_config.py` ä¸­è®¾ç½®ï¼š

```python
# çˆ¬å–äºŒçº§è¯„è®ºçš„æ•°é‡æ§åˆ¶(å•ä¸ªä¸€çº§è¯„è®ºä¸‹)
# è®¾ç½®ä¸º6å¯ä»¥è·å–"ç¬¬ä¸€æ¬¡ç‚¹å‡»å±•å¼€"åçš„æ‰€æœ‰è¯„è®º
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 6
```

### é…ç½®é€‰é¡¹è¯´æ˜

| é…ç½®å€¼ | è¯´æ˜ | æ•ˆæœ |
|--------|------|------|
| `6` | æ¨èè®¾ç½® | è·å–ç¬¬ä¸€æ¬¡å±•å¼€åæ˜¾ç¤ºçš„æ‰€æœ‰è¯„è®ºï¼ˆæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼‰ |
| `0` | ä¸é™åˆ¶ | è·å–æ‰€æœ‰äºŒçº§è¯„è®ºï¼ˆéœ€è¦å¤šæ¬¡APIè°ƒç”¨ï¼‰ |
| å…¶ä»–æ•°å­— | è‡ªå®šä¹‰ | è·å–æŒ‡å®šæ•°é‡çš„äºŒçº§è¯„è®º |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬ä½¿ç”¨ï¼ˆæ¨èé…ç½®ï¼‰

```python
# config/base_config.py
ENABLE_GET_SUB_COMMENTS = True
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 6
```

è¿è¡Œç¨‹åºåï¼Œä¼šè‡ªåŠ¨è·å–ï¼š
- âœ… æ‰€æœ‰ä¸€çº§è¯„è®º
- âœ… æ¯ä¸ªä¸€çº§è¯„è®ºçš„å‰6æ¡äºŒçº§è¯„è®ºï¼ˆç¬¬ä¸€æ¬¡å±•å¼€çš„æ•°é‡ï¼‰

### 2. è·å–æ‰€æœ‰äºŒçº§è¯„è®º

å¦‚æœéœ€è¦è·å–æ›´å¤šçš„äºŒçº§è¯„è®ºï¼š

```python
# config/base_config.py
ENABLE_GET_SUB_COMMENTS = True
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 0  # 0è¡¨ç¤ºä¸é™åˆ¶
```

æ³¨æ„ï¼šè¿™ä¼šå¢åŠ APIè°ƒç”¨æ¬¡æ•°å’Œçˆ¬å–æ—¶é—´ã€‚

### 3. ä¸è·å–äºŒçº§è¯„è®º

```python
# config/base_config.py
ENABLE_GET_SUB_COMMENTS = False
```

## ğŸ“Š å®é™…æ•ˆæœå¯¹æ¯”

### é…ç½®ä¸º 6ï¼ˆæ¨èï¼‰

```
âœ… è·å–é€Ÿåº¦ï¼šå¿«
âœ… APIè°ƒç”¨ï¼šå°‘
âœ… ç¬¦åˆç”¨æˆ·å®é™…æµè§ˆè¡Œä¸º
âœ… æ•°æ®å®Œæ•´æ€§ï¼šç¬¬ä¸€æ¬¡å±•å¼€çš„æ‰€æœ‰å†…å®¹

ç¤ºä¾‹è¾“å‡ºï¼š
- ä¸€çº§è¯„è®º: 50æ¡
- äºŒçº§è¯„è®º: æœ€å¤š 50 Ã— 6 = 300æ¡
```

### é…ç½®ä¸º 0ï¼ˆä¸é™åˆ¶ï¼‰

```
âš ï¸ è·å–é€Ÿåº¦ï¼šæ…¢
âš ï¸ APIè°ƒç”¨ï¼šå¤š
âš ï¸ å¯èƒ½å¢åŠ è¢«é™åˆ¶çš„é£é™©
âœ… æ•°æ®å®Œæ•´æ€§ï¼šæ‰€æœ‰äºŒçº§è¯„è®º

ç¤ºä¾‹è¾“å‡ºï¼š
- ä¸€çº§è¯„è®º: 50æ¡
- äºŒçº§è¯„è®º: å¯èƒ½ > 1000æ¡ï¼ˆå–å†³äºå®é™…è¯„è®ºæ•°ï¼‰
```

## ğŸ’¡ æ¨èå®è·µ

### åœºæ™¯1ï¼šå¿«é€Ÿæ•°æ®é‡‡é›†
```python
CRAWLER_MAX_COMMENTS_COUNT_SINGLENOTES = 20  # åªè·å–20æ¡ä¸€çº§è¯„è®º
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 6  # æ¯æ¡è·å–6æ¡äºŒçº§è¯„è®º
```
**ç»“æœ**ï¼šçº¦ 20 + 120 = 140æ¡è¯„è®º

### åœºæ™¯2ï¼šå®Œæ•´è¯„è®ºåˆ†æ
```python
CRAWLER_MAX_COMMENTS_COUNT_SINGLENOTES = 50  # è·å–50æ¡ä¸€çº§è¯„è®º
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 6  # æ¯æ¡è·å–6æ¡äºŒçº§è¯„è®º
```
**ç»“æœ**ï¼šçº¦ 50 + 300 = 350æ¡è¯„è®º

### åœºæ™¯3ï¼šæ·±åº¦æ•°æ®æŒ–æ˜
```python
CRAWLER_MAX_COMMENTS_COUNT_SINGLENOTES = 100  # è·å–100æ¡ä¸€çº§è¯„è®º
CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT = 0  # è·å–æ‰€æœ‰äºŒçº§è¯„è®º
```
**ç»“æœ**ï¼šæ‰€æœ‰è¯„è®ºï¼ˆæ—¶é—´è¾ƒé•¿ï¼‰

## ğŸ” æŠ€æœ¯åŸç†

ä»£ç ä¸­çš„å®ç°é€»è¾‘ï¼š

```python
# media_platform/xhs/client.py

async def get_comments_all_sub_comments(...):
    """
    è·å–æŒ‡å®šä¸€çº§è¯„è®ºä¸‹çš„äºŒçº§è¯„è®º
    
    å°çº¢ä¹¦é¡µé¢å±•å¼€è§„åˆ™ï¼š
    - æ€»æ•° > 6æ¡ â†’ ç¬¬ä¸€æ¬¡å±•å¼€æ˜¾ç¤º6æ¡
    - æ€»æ•° â‰¤ 6æ¡ â†’ ç¬¬ä¸€æ¬¡å±•å¼€æ˜¾ç¤ºå…¨éƒ¨
    """
    max_sub_comments = config.CRAWLER_MAX_SUB_COMMENTS_COUNT_PER_COMMENT
    
    # å¦‚æœè®¾ç½®ä¸º6ï¼Œåªè·å–å‰6æ¡
    if max_sub_comments > 0 and sub_comments_count >= max_sub_comments:
        break
```

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡ç¤ºä¾‹

è¿è¡Œåå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š

```
[XiaoHongShuCrawler] Begin get note id comments 65f1234567890abc
[XiaoHongShuClient] Fetching primary comments...
[XiaoHongShuClient] Found 25 primary comments
[XiaoHongShuClient] Fetching sub-comments for comment 1/25
[XiaoHongShuClient] Got 6 sub-comments (limit: 6)
[XiaoHongShuClient] Fetching sub-comments for comment 2/25
[XiaoHongShuClient] Got 3 sub-comments (total < 6, all loaded)
...
[XiaoHongShuCrawler] Total comments: 25 primary + 127 sub = 152 total
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åçˆ¬è™«é™åˆ¶**
   - åˆç†è®¾ç½® `CRAWLER_MAX_SLEEP_SEC`ï¼ˆå»ºè®®2-5ç§’ï¼‰
   - ä¸è¦é¢‘ç¹å¤§é‡çˆ¬å–
   - ä½¿ç”¨å·²ç™»å½•çš„è´¦å·

2. **æ•°æ®å‡†ç¡®æ€§**
   - è®¾ç½®ä¸º6å¯ä»¥ç²¾ç¡®åŒ¹é…"ç¬¬ä¸€æ¬¡å±•å¼€"çš„è¡Œä¸º
   - å¦‚éœ€æ›´å¤šæ•°æ®ï¼Œè®¾ç½®ä¸º0æˆ–æ›´å¤§çš„æ•°å€¼

3. **æ€§èƒ½è€ƒè™‘**
   - äºŒçº§è¯„è®ºæ•°é‡è¶Šå¤šï¼Œçˆ¬å–æ—¶é—´è¶Šé•¿
   - å»ºè®®æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæˆ‘è·å–ä¸åˆ°6æ¡äºŒçº§è¯„è®ºï¼Ÿ

**A:** å¯èƒ½çš„åŸå› ï¼š
- è¯¥ä¸€çº§è¯„è®ºæœ¬èº«çš„äºŒçº§è¯„è®ºæ€»æ•° < 6æ¡
- APIè¿”å›æ•°æ®ä¸å®Œæ•´ï¼ˆç½‘ç»œé—®é¢˜æˆ–è¢«é™åˆ¶ï¼‰
- æ£€æŸ¥æ—¥å¿—è¾“å‡ºæŸ¥çœ‹å®é™…è·å–æƒ…å†µ

### Q2: å¦‚ä½•éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

**A:** æŸ¥çœ‹CSVè¾“å‡ºæ–‡ä»¶ï¼š
```bash
# ç»Ÿè®¡äºŒçº§è¯„è®ºæ•°é‡
åœ¨ data/xhs/csv/search_comments_*.csv ä¸­æŸ¥çœ‹
æ¯ä¸ªä¸€çº§è¯„è®ºæœ€å¤šåº”è¯¥æœ‰6æ¡äºŒçº§è¯„è®ºï¼ˆå¦‚æœæ€»æ•°>6ï¼‰
```

### Q3: å¯ä»¥é’ˆå¯¹ä¸åŒç¬”è®°è®¾ç½®ä¸åŒçš„æ•°é‡å—ï¼Ÿ

**A:** å½“å‰ç‰ˆæœ¬ä½¿ç”¨ç»Ÿä¸€é…ç½®ã€‚å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯ä»¥ä¿®æ”¹ä»£ç ï¼š

```python
# åœ¨è°ƒç”¨æ—¶ä¼ å…¥è‡ªå®šä¹‰å‚æ•°
await self.xhs_client.get_note_all_comments(
    note_id=note_id,
    max_sub_comments=6,  # è‡ªå®šä¹‰æ•°é‡
)
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®ä¸»README](../README.md)
- [å¸¸è§é—®é¢˜](å¸¸è§é—®é¢˜.md)
- [é…ç½®è¯´æ˜](../config/base_config.py)

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2025-10-15**: å‘ç°å¹¶è®°å½•å°çº¢ä¹¦äºŒçº§è¯„è®ºå±•å¼€è§„åˆ™
- **2025-10-15**: æ›´æ–°é…ç½®é»˜è®¤å€¼ä¸º6
- **2025-10-15**: æ·»åŠ ä»£ç æ³¨é‡Šè¯´æ˜

---

**æç¤º**ï¼šå¦‚æœä½ å‘ç°å°çº¢ä¹¦çš„å±•å¼€è§„åˆ™æœ‰å˜åŒ–ï¼Œè¯·åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£å’Œé…ç½®ï¼


